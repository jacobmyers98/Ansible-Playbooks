---
# Docker install with configuration and mounting. For Ubuntu 22.04 Server

- hosts: all
  become: true
  tasks:
  - name: Install docker
    shell: apt install docker

  - name: Install Docker-Compose
    shell: apt-get install docker-compose-plugin
    shell: apt-get install csh

  - name: Mounting network drives
    shell: 
    shell: 
    shell: 
    shell: 
    shell: 

  - name: Creating Docker environment
    shell: mkdir /home/torrent/docker_services
    shell: chmod 755 /home/torrent/docker_services

  - name: Creating Docker-Compose file
    copy:
      dest: /home/torrent/docker_services/docker-compose.yaml
      content: |
        version: "3.8"
        services:
          radarr:
            image: lscr.io/linuxserver/radarr
            ports:
              - "7878:7878" # port mapping
            volumes:
              - type: bind
                source: /mnt/Media/Torrent_Configs/radarr/config    # Host OS
                target: /radarr/config    # Container OS
              - type: bind
                source: /mnt/Media/Torrent_Configs/radarr/downloads    # Host OS
                target: /radarr/downloads    # Container OS
              - type: bind
                source: /mnt/Media    # Host OS
                target: /mnt/Media    # Container OS
              - type: bind
                source: /mnt/Media/Torrent/Incomplete    # Host OS
                target: /mnt/Torrent/Incomplete    # Container OS
              - type: bind
                source: /mnt/Media/Torrent    # Host OS
                target: /mnt/Torrent    # Container OS
              - type: bind
              source: /mnt/Movies    # Host OS
              target: /mnt/Movies    # Container OS
            environment:
              TZ: America/Denver
              PUID: 0 # set this to the UID of your user
              PGID: 0 # set this to the GID of your user
            restart: unless-stopped

          sonarr:
            image: lscr.io/linuxserver/sonarr
            ports:
              - "8989:8989" # port mapping
            volumes:
              - type: bind
                source: /mnt/Media/Torrent_Configs/sonarr/config    # Host OS
                target: /sonarr/config    # Container OS
              - type: bind
                source: /mnt/Media/Torrent_Configs/sonarr/downloads    # Host OS
                target: /sonarr/downloads    # Container OS
              - type: bind
                source: /mnt/Media    # Host OS
                target: /mnt/Media    # Container OS
              - type: bind
                source: /mnt/Media/Torrent/Incomplete    # Host OS
                target: /mnt/Torrent/Incomplete    # Container OS
              - type: bind
                source: /mnt/Media/Torrent    # Host OS
                target: /mnt/Torrent    # Container OS
              - type: bind
                source: /mnt/Shows    # Host OS
                target: /mnt/Shows    # Container OS
            environment:
              TZ: America/Denver
              PUID: 0 # set this to the UID of your user
              PGID: 0 # set this to the GID of your user
            restart: unless-stopped

          qbittorrent:
            image: lscr.io/linuxserver/qbittorrent
            ports:
              - 8080:8080
              - 6881:6881
              - 6881:6881/udp
            environment:
              - PUID: 0
              - PGID: 0
              - TZ: America/Denver
              - WEBUI_PORT: 8080
            volumes:
              - type: bind
                source: /mnt/Media/Torrent_Configs/qbittorrent/config    # Host OS
                target: /qbittorrent/config    # Container OS
              - type: bind
                source: /mnt/Media/Torrent_Configs/qbittorrent/downloads    # Host OS
                target: /qbittorrent/downloads    # Container OS
              - type: bind
                source: /mnt/Media    # Host OS
                target: /mnt/Media    # Container OS
              - type: bind
                source: /mnt/Media/Torrent/Incomplete    # Host OS
                target: /mnt/Torrent/Incomplete    # Container OS
              - type: bind
                source: /mnt/Media/Torrent    # Host OS
                target: /mnt/Torrent    # Container OS
              - type: bind
                source: /mnt/Movies    # Host OS
                target: /mnt/Movies    # Container OS
              - type: bind
                source: /mnt/Shows    # Host OS
                target: /mnt/Shows    # Container OS
            restart: unless-stopped

          jackett:
            image: lscr.io/linuxserver/jackett
            ports:
              - 9117:9117
            environment:
              - PUID: 0
              - PGID: 0
              - TZ: America/Denver
            volumes:
              - type: bind
                source: /mnt/Media/Torrent_Configs/jackett/config    # Host OS
                target: /jackett/config    # Container OS
              - type: bind
                source: /mnt/Media/Torrent_Configs/jackett/downloads    # Host OS
                target: /jackett/downloads    # Container OS
              - type: bind
                source: /mnt/Media    # Host OS
                target: /mnt/Media    # Container OS
              - type: bind
                source: /mnt/Media/Torrent/Incomplete    # Host OS
                target: /mnt/Torrent/Incomplete    # Container OS
              - type: bind
                source: /mnt/Media/Torrent    # Host OS
                target: /mnt/Torrent    # Container OS
              - type: bind
                source: /mnt/Movies    # Host OS
                target: /mnt/Movies    # Container OS
              - type: bind
                source: /mnt/Shows    # Host OS
                target: /mnt/Shows    # Container OS
            restart: unless-stopped

            uptime-kuma:
              image: louislam/uptime-kuma
              container_name: uptime-kuma
              volumes:
              - type: bind
                source: /mnt/Media/Torrent_Configs/uptime/config    # Host OS
                target: /uptime/config    # Container OS
              ports:
              - 3001:3001  # <Host Port>:<Container Port>
              restart: unless-stopped

            heimdall:
              image: linuxserver/heimdall
              container_name: heimdall
              environment:
                - PUID=0
                - PGID=0
                - TZ=  America/Denver
              volumes:
                - type: bind
                source: /mnt/Media/Torrent_Configs/heimdall/config    # Host OS
                target: /heimdall/config    # Container OS
              ports:
                - 443:443
              restart: unless-stopped



  - name: Update
    shell: apt update
    shell: apt upgrade
    shell: docker-compose up -d
