---
# Docker install with configuration and mounting. For Ubuntu 22.04 Server

- hosts: all
  become: true
  tasks:
  - name: Install docker
    shell: apt install docker

  - name: Install Docker-Compose
    shell: apt-get install docker-compose-plugin
    shell: apt-get install csh

  - name: Mounting network drives
    shell: 
    shell: 
    shell: 
    shell: 
    shell: 

  - name: Creating Docker environment
    shell: mkdir /home/torrent/docker_services
    shell: chmod 755 /home/torrent/docker_services

  - name: Creating Docker-Compose file
    copy:
      dest: /home/torrent/docker_services/docker-compose.yaml
      content: |
        version: "3.8"
        services:
          radarr:
            image: lscr.io/linuxserver/radarr
            ports:
              - "7878:7878" # port mapping
            volumes:
              - "./config/radarr:/config"
              - "/storage/Downloads/complete:/downloads"
              - "/storage/Movies:/storage/Movies"
            environment:
              TZ: America/Denver
              PUID: 1000 # set this to the UID of your user
              PGID: 1000 # set this to the GID of your user
            restart: unless-stopped

          sonarr:
            image: lscr.io/linuxserver/sonarr
            ports:
              - "8989:8989" # port mapping
            volumes:
              - "./config/radarr:/config" # config directory for sonarr
              - "/storage/Downloads/complete:/downloads" # completed downloads directory from qbit
              - "/storage/Movies:/storage/Movies" # where sonarr will copy your tv shows. add as many of these as you need
            environment:
              TZ: America/Denver
              PUID: 1000 # set this to the UID of your user
              PGID: 1000 # set this to the GID of your user
            restart: unless-stopped

          qbittorrent:
            image: lscr.io/linuxserver/qbittorrent
            ports:
              - 8080:8080
              - 6881:6881
              - 6881:6881/udp
            environment:
              - PUID: 1000
              - PGID: 1000
              - TZ: America/Denver
              - WEBUI_PORT: 8080
            volumes:
              - /path/to/appdata/config:/config
              - /path/to/downloads:/downloads
            restart: unless-stopped

          jackett:
            image: lscr.io/linuxserver/jackett
            ports:
              - 9117:9117
            environment:
              - PUID: 1000
              - PGID: 1000
              - TZ: America/Denver
            volumes:
              - /config:/config
              - type: bind
                source: /mnt/Movies    # Host OS
                target: /mnt/Movies    # Container OS
            restart: unless-stopped



  - name: Update
    shell: apt update
    shell: apt upgrade
    shell: docker-compose up -d
